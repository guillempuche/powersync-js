"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[380],{9125:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var s=t(4246),a=t(1670);const i={id:"index",title:"@journeyapps/powersync-sdk-react-native",sidebar_label:"Readme",sidebar_position:0,custom_edit_url:null},r="PowerSync SDK for React Native",l={id:"react-native-sdk/index",title:"@journeyapps/powersync-sdk-react-native",description:"PowerSync is a service and set of SDKs that keeps Postgres databases in sync with on-device SQLite databases. See a summary of features here.",source:"@site/docs/react-native-sdk/index.md",sourceDirName:"react-native-sdk",slug:"/react-native-sdk/",permalink:"/powersync-react-native-sdk/react-native-sdk/",draft:!1,unlisted:!1,editUrl:null,tags:[],version:"current",sidebarPosition:0,frontMatter:{id:"index",title:"@journeyapps/powersync-sdk-react-native",sidebar_label:"Readme",sidebar_position:0,custom_edit_url:null},sidebar:"docsSidebar",next:{title:"Exports",permalink:"/powersync-react-native-sdk/react-native-sdk/modules"}},o={},c=[{value:"Beta Release",id:"beta-release",level:2},{value:"Install Package",id:"install-package",level:2},{value:"Install Peer Dependency: SQLite",id:"install-peer-dependency-sqlite",level:2},{value:"Install Polyfills",id:"install-polyfills",level:2},{value:"Fetch",id:"fetch",level:3},{value:"Babel Plugins: Watched Queries",id:"babel-plugins-watched-queries",level:3},{value:"Native Projects",id:"native-projects",level:2},{value:"Android",id:"android",level:2},{value:"iOS",id:"ios",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"powersync-sdk-for-react-native",children:"PowerSync SDK for React Native"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://powersync.co",children:"PowerSync"})," is a service and set of SDKs that keeps Postgres databases in sync with on-device SQLite databases. See a summary of features ",(0,s.jsx)(n.a,{href:"https://docs.powersync.co/client-sdk-references/react-native-and-expo",children:"here"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"beta-release",children:"Beta Release"}),"\n",(0,s.jsx)(n.p,{children:"This React Native SDK package is currently in a beta release."}),"\n",(0,s.jsx)(n.h1,{id:"installation",children:"Installation"}),"\n",(0,s.jsx)(n.h2,{id:"install-package",children:"Install Package"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npx expo install @journeyapps/powersync-sdk-react-native\n"})}),"\n",(0,s.jsx)(n.h2,{id:"install-peer-dependency-sqlite",children:"Install Peer Dependency: SQLite"}),"\n",(0,s.jsxs)(n.p,{children:["This SDK currently requires ",(0,s.jsx)(n.code,{children:"@journeyapps/react-native-quick-sqlite"})," as a peer dependency."]}),"\n",(0,s.jsx)(n.p,{children:"Install it in your app with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npx expo install @journeyapps/react-native-quick-sqlite\n"})}),"\n",(0,s.jsx)(n.h2,{id:"install-polyfills",children:"Install Polyfills"}),"\n",(0,s.jsx)(n.h3,{id:"fetch",children:"Fetch"}),"\n",(0,s.jsxs)(n.p,{children:["This SDK requires HTTP streaming in order to function. The following ",(0,s.jsx)(n.code,{children:"fetch"})," polyfills are required for the React Native implementation of ",(0,s.jsx)(n.code,{children:"fetch"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"react-native-fetch-api"}),"\n",(0,s.jsx)(n.li,{children:"react-native-polyfill-globals"}),"\n",(0,s.jsx)(n.li,{children:"react-native-url-polyfill"}),"\n",(0,s.jsx)(n.li,{children:"text-encoding"}),"\n",(0,s.jsx)(n.li,{children:"web-streams-polyfill"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"These are listed as peer dependencies and need to be added to the React Native project"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npx expo install react-native-fetch-api react-native-polyfill-globals react-native-url-polyfill text-encoding web-streams-polyfill base-64 react-native-get-random-values\n"})}),"\n",(0,s.jsx)(n.p,{children:"Enable the polyfills in React Native app with"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-JavaScript",children:"// App.js\nimport 'react-native-polyfill-globals/auto';\n"})}),"\n",(0,s.jsx)(n.h3,{id:"babel-plugins-watched-queries",children:"Babel Plugins: Watched Queries"}),"\n",(0,s.jsx)(n.p,{children:"Watched queries require support for Async Iterators. Expo apps currently require polyfill and Babel plugins in order to use this functionality."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npx expo install @azure/core-asynciterator-polyfill\n"})}),"\n",(0,s.jsx)(n.p,{children:"Make sure to import the polyfill early in your application"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-JavaScript",children:"// App.js\nimport '@azure/core-asynciterator-polyfill';\n"})}),"\n",(0,s.jsx)(n.p,{children:"Install the async generator Babel plugin"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"yarn add -D @babel/plugin-transform-async-generator-functions\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Add the Babel plugin to your ",(0,s.jsx)(n.code,{children:"babel.config.js"})," file"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-JavaScript",children:"module.exports = function (api) {\n return {\n   presets: [...],\n   plugins: [\n     // ... Other plugins\n     '@babel/plugin-transform-async-generator-functions'\n   ]\n };\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"native-projects",children:"Native Projects"}),"\n",(0,s.jsx)(n.p,{children:"This package uses native libraries. Create native Android and iOS projects (if not created already) with"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npx expo run:android\n"})}),"\n",(0,s.jsx)(n.h1,{id:"getting-started",children:"Getting Started"}),"\n",(0,s.jsxs)(n.p,{children:["See our ",(0,s.jsx)(n.a,{href:"https://docs.powersync.co/usage/installation/client-side-setup/integrating-with-your-backend#react-native-and-expo",children:"Docs"})," for detailed instructions."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-JavaScript",children:"import {\n  Column,\n  ColumnType,\n  RNQSPowerSyncDatabaseOpenFactory,\n  Schema,\n  Table\n} from '@journeyapps/powersync-sdk-react-native';\n\nexport const AppSchema = new Schema([\n  new Table({ name: 'customers', columns: [new Column({ name: 'name', type: ColumnType.TEXT })] })\n]);\n\nlet PowerSync;\n\nexport const openDatabase = async () => {\n  const PowerSync = new RNQSPowerSyncDatabaseOpenFactory({\n    schema: AppSchema,\n    dbFilename: 'test.sqlite'\n    //location: 'optional location directory to DB file'\n  }).getInstance();\n\n  await PowerSync.init();\n\n  // Run local statements.\n  await PowerSync.execute('INSERT INTO customers(id, name) VALUES(uuid(), ?)', ['Fred']);\n};\n\nclass Connector {\n  async fetchCredentials() {\n    // TODO logic to fetch a session\n    return {\n      endpoint: '[The PowerSync instance URL]',\n      token: 'An authentication token',\n      expiresAt: 'When the token expires',\n      userID: 'User ID to associate the session with'\n    };\n  }\n\n  async uploadData(database) {\n    // Upload local changes to backend, see docs for example\n  }\n}\n\nexport const connectPowerSync = async () => {\n  const connector = new Connector(); // Which was declared above\n  await PowerSync.connect(connector);\n};\n\n// Use queries in React Components\nexport const CustomerListDisplay = () => {\n  const customers = usePowerSyncWatchedQuery('SELECT * from customers');\n\n  return (\n    <View>\n      {customers.map((l) => (\n        <Text key={l.id}>{JSON.stringify(l)}</Text>\n      ))}\n    </View>\n  );\n};\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Refer to our ",(0,s.jsx)(n.a,{href:"https://docs.powersync.co/client-sdk-references/react-native-and-expo",children:"full documentation"})," to learn more."]}),"\n",(0,s.jsx)(n.h1,{id:"known-issues",children:"Known Issues"}),"\n",(0,s.jsx)(n.h2,{id:"android",children:"Android"}),"\n",(0,s.jsxs)(n.p,{children:["The PowerSync connection relies heavily on HTTP streams. React Native does not support streams out of the box, so we use the ",(0,s.jsx)(n.a,{href:"#polyfills-fetch",children:"polyfills"})," mentioned. There is currently an open ",(0,s.jsx)(n.a,{href:"https://github.com/facebook/flipper/issues/2495",children:"issue"})," where the Flipper network plugin does not allow Stream events to fire. This plugin needs to be ",(0,s.jsx)(n.a,{href:"https://stackoverflow.com/questions/69235694/react-native-cant-connect-to-sse-in-android/69235695#69235695",children:"disabled"})," in order for HTTP streams to work."]}),"\n",(0,s.jsxs)(n.p,{children:["Uncomment the following from\n",(0,s.jsx)(n.code,{children:"android/app/src/debug/java/com/<projectname>/ReactNativeFlipper.java"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"      // NetworkFlipperPlugin networkFlipperPlugin = new NetworkFlipperPlugin();\n      // NetworkingModule.setCustomClientBuilder(\n      //     new NetworkingModule.CustomClientBuilder() {\n      //       @Override\n      //       public void apply(OkHttpClient.Builder builder) {\n      //         builder.addNetworkInterceptor(new FlipperOkhttpInterceptor(networkFlipperPlugin));\n      //       }\n      //     });\n      // client.addPlugin(networkFlipperPlugin);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Disable the dev client network inspector\n",(0,s.jsx)(n.code,{children:"android/gradle.properties"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"# Enable network inspector\nEX_DEV_CLIENT_NETWORK_INSPECTOR=false\n"})}),"\n",(0,s.jsx)(n.h2,{id:"ios",children:"iOS"}),"\n",(0,s.jsx)(n.p,{children:"Testing offline mode on an iOS simulator by disabling the host machine's entire internet connection will cause the device to remain offline even after the internet connection has been restored. This issue seems to affect all network requests in an application."})]})}function p(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1670:(e,n,t)=>{t.d(n,{Z:()=>l,a:()=>r});var s=t(7378);const a={},i=s.createContext(a);function r(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);